{% extends "blog/base.html" %}

{% block title %}{{ post.title }}{% endblock %}

{% block content %}
  <article class="post-detail">
    <h1>{{ post.title }}</h1>
    <p class="date">
      Опубліковано {{ post.publish }} автором {{ post.author }}
    </p>
    <div class="post-body">
      {{ post.body|linebreaks }}
    </div>
    
    {% if post.tags.all %}
    <div class="post-tags">
      <strong>Теги:</strong>
      {% for tag in post.tags.all %}
        <a href="{% url 'blog:post_list_by_tag' tag.slug %}" class="tag">
          {{ tag.name }}
        </a>
        {% if not forloop.last %}, {% endif %}
      {% endfor %}
    </div>
    {% endif %}
    
    <div class="share-post">
      <a href="{% url 'blog:post_share' post.id %}" class="btn btn-primary">
        Поділитися
      </a>
    </div>

    <!-- Коментарі -->
    <div class="comments-section">
      <h2>Коментарі ({{ comments.count }})</h2>
      
      {% for comment in comments %}
        <div class="comment">
          <div class="comment-header">
            <strong>{{ comment.name }}</strong>
            <span class="comment-date">{{ comment.created|date:"d.m.Y H:i" }}</span>
          </div>
          <div class="comment-body">
            {{ comment.body|linebreaks }}
          </div>
        </div>
      {% empty %}
        <p>Ще немає коментарів. Будьте першим!</p>
      {% endfor %}

      <!-- Форма додавання коментаря -->
      <div class="add-comment">
        <h3>Додати коментар</h3>
        {% if new_comment %}
          <div class="alert alert-success" role="alert">
            Ваш коментар успішно додано і очікує модерації.
          </div>
        {% else %}
          <form method="post">
            {% csrf_token %}
            {{ comment_form.as_p }}
            <button type="submit" class="btn btn-primary">Надіслати</button>
          </form>
        {% endif %}
      </div>
    </div>
    
    {% if similar_posts %}
    <div class="similar-posts">
      <h3>Схожі публікації</h3>
      <div class="similar-posts-grid">
        {% for post in similar_posts %}
        <div class="similar-post">
          <a href="{{ post.get_absolute_url }}" class="similar-post-link">
            <h4>{{ post.title }}</h4>
            <p class="similar-post-date">{{ post.publish|date:"d.m.Y" }}</p>
            <p class="similar-post-preview">
              {{ post.body|truncatewords:15|linebreaks }}
            </p>
          </a>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
  </article>
{% endblock %}
